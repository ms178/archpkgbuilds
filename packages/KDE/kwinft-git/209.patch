From 2b126bda1c421724a3e34e8d90ce2b9ec776d627 Mon Sep 17 00:00:00 2001
From: Tom Englund <tomenglund26@gmail.com>
Date: Tue, 24 May 2022 04:53:11 +0200
Subject: [PATCH 1/2] fix: ensure we dont endlessly loop in groups

adding the newly created group window as a child to all members and all
its members a child for the window creates cyclic loops in
stacking_order and find_modal, the comments say they should be added as
such according to the ICCCM but all the ICCCM says about this is, It is
up to the window manager to determine the policy for treating the
windows in a group.
---
 win/x11/transient.h | 7 -------
 1 file changed, 7 deletions(-)

diff --git a/win/x11/transient.h b/win/x11/transient.h
index e6eff2e5e..8dbf865e6 100644
--- a/win/x11/transient.h
+++ b/win/x11/transient.h
@@ -175,7 +175,6 @@ void update_group(Win* win, bool add)
             win->in_group->addMember(win);
         }
         auto const win_is_group_tr = win->groupTransient();
-        auto const win_is_normal_tr = !win_is_group_tr && win->transient()->lead();
 
         // This added window must be set as transient child for all windows that have no direct
         // or indirect transient relation with it (that way we ensure there are no cycles).
@@ -192,14 +191,8 @@ void update_group(Win* win, bool add)
                 // have no cycle.
                 if (!member_is_normal_tr && !member->transient()->is_follower_of(win)) {
                     member->transient()->add_child(win);
-                    continue;
                 }
             }
-
-            if (member_is_group_tr && !win_is_normal_tr
-                && !win->transient()->is_follower_of(member)) {
-                win->transient()->add_child(member);
-            }
         }
     } else {
         win->in_group->ref();
-- 
GitLab


From 6bac8a5b493c37743e7aa59588fbc6c636718d1f Mon Sep 17 00:00:00 2001
From: Tom Englund <tomenglund26@gmail.com>
Date: Fri, 3 Jun 2022 10:04:47 +0200
Subject: [PATCH 2/2] fix: check for rules().checkMaxSize in maxSize

seems a typo has been left over here using checkMinSize in maxSize.
---
 win/wayland/window.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/win/wayland/window.cpp b/win/wayland/window.cpp
index d68df8721..6caa7224b 100644
--- a/win/wayland/window.cpp
+++ b/win/wayland/window.cpp
@@ -230,7 +230,7 @@ QSize window::minSize() const
 
 QSize window::maxSize() const
 {
-    return control->rules().checkMinSize(toplevel->maximumSize());
+    return control->rules().checkMaxSize(toplevel->maximumSize());
 }
 
 bool window::isCloseable() const
-- 
GitLab

