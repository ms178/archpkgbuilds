From a5f74079085c300b41472238fd09d9a4e2cfaef1 Mon Sep 17 00:00:00 2001
From: Spiky Caterpillar <spikycaterpillar_tvguho@deekoo.net>
Date: Wed, 16 Nov 2022 23:18:44 +0000
Subject: [PATCH] No longer leak FDs on VT switch.

---
 hw/xfree86/os-support/linux/systemd-logind.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/hw/xfree86/os-support/linux/systemd-logind.c b/hw/xfree86/os-support/linux/systemd-logind.c
index dbb00cd85..452efb83a 100644
--- a/hw/xfree86/os-support/linux/systemd-logind.c
+++ b/hw/xfree86/os-support/linux/systemd-logind.c
@@ -426,6 +426,7 @@ message_filter(DBusConnection * connection, DBusMessage * message, void *data)
         info->active = TRUE;
 
         if (pdev) {
+	    close(fd);
             pdev->flags &= ~XF86_PDEV_PAUSED;
         } else
             systemd_logind_set_input_fd_for_all_devs(major, minor, fd,
-- 
GitLab

