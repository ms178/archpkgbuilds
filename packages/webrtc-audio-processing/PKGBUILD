# Maintainer: Jan Alexander Steffens (heftig) <heftig@archlinux.org>

pkgname=webrtc-audio-processing
pkgver=1.3
pkgrel=5.1
pkgdesc="AudioProcessing library based on Google's implementation of WebRTC"
url="https://freedesktop.org/software/pulseaudio/webrtc-audio-processing/"
arch=(x86_64)
license=(custom)
depends=(gcc-libs)
makedepends=(git)
provides=(libwebrtc_audio_processing.so)
_commit=8e258a1933d405073c9e6465628a69ac7d2a1f13  # tags/v1.3^0
source=("git+https://gitlab.freedesktop.org/pulseaudio/webrtc-audio-processing.git#commit=$_commit")
b2sums=('SKIP')

pkgver() {
  cd $pkgname
  git describe --tags | sed 's/^v//;s/[^-]*-g/r&/;s/-/+/g'
}

build() {

      arch-meson "$pkgname" build \
      -D b_ndebug=true \
      -D b_pie=false \
      -D c_std=gnu2x \
      -D cpp_std=gnu++17 \
      -D b_lto=true \
      --buildtype=release \
      --wrap-mode=nofallback

      meson configure build --no-pager
      ninja -C build
     }

package_webrtc-audio-processing() {
  meson install -C build --destdir "$pkgdir"
  install -m644 -Dt "${pkgdir}/usr/share/licenses/${pkgname}" webrtc-audio-processing/COPYING
}

# vim:set sw=2 sts=-1 et:
