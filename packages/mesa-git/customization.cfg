# mesa-git-tkg config file
# vim: set ft=bash :
#
# Optimized for: AMD Vega 64 + Intel Core i7-14700KF (no iGPU)

##############################################################################
#                                 OPTIONS                                    #
##############################################################################

# External config file to use - If the given file exists in path, it will
# override default config (customization.cfg)
# Default: ~/.config/frogminer/mesa-git.cfg
_EXT_CONFIG_PATH=~/.config/frogminer/mesa-git.cfg

# LLVM package tree to use by default to build mesa-git against.
#   1: llvm-minimal-git (AUR)
#   2: llvm-git (AUR)
#   3: llvm-git from LordHeavy unofficial repo
#   4: llvm (stable from extra) - Default
MESA_WHICH_LLVM=4

# Set to "false" to skip cleanups.
# Default "true" will enable housecleaning and sanity tasks.
_NUKR="true"

# Compiler to use: "gcc" or "clang"
# Default: "gcc"
# Note: clang may provide slightly better performance for Mesa
_compiler="clang"

# Custom GCC root dir - Leave empty to use system compilers.
# Example: CUSTOM_GCC_PATH="/home/user/gcc-custom-13.0.0"
CUSTOM_GCC_PATH=""

# Enable lib32 (32-bit) build for Wine/Proton gaming
# Set to "true" to enable, "false" to disable
_lib32="true"

# Use local glesv2.pc and egl.pc - These are provided by libglvnd
# Set to "true" only if you need to override system-provided .pc files
_localglesv2pc="false"
_localeglpc="false"

##############################################################################
#                              DRIVER SELECTION                              #
##############################################################################

# Gallium drivers to include in the build
# ============================================================================
# For AMD Vega 64: radeonsi is required
# Recommended drivers for your setup:
#   - radeonsi: AMD Vega 64 (GCN 5th gen)
#   - zink: OpenGL-over-Vulkan (can provide better perf in some cases)
#   - llvmpipe: Software fallback (useful for debugging)
#   - virgl: Virtual GPU (useful for VMs)
#
# NOT needed for your hardware (no Intel iGPU):
#   - iris, crocus, i915 (Intel GPUs)
#   - nouveau (NVIDIA)
#   - svga (VMware)
# ============================================================================
_gallium_drivers="radeonsi,zink,llvmpipe"

# Vulkan drivers to include in the build
# ============================================================================
# For AMD Vega 64: amd (RADV) is the primary driver
# Options: amd, intel, intel_hasvk, swrast, virtio, nouveau
#
# Recommended for your setup:
#   - amd: RADV for Vega 64 (excellent performance)
#   - swrast: Lavapipe software Vulkan (debugging/fallback)
#
# NOT needed (no Intel iGPU):
#   - intel, intel_hasvk
# ============================================================================
_vulkan_drivers="amd,swrast"

# Patent-encumbered codecs to build support for (vaapi, vdpau, vulkan video)
# ============================================================================
# Options:
#   Patent-encumbered: vc1dec, h264dec, h264enc, h265dec, h265enc
#   Free codecs: av1dec, av1enc, vp9dec, mpeg12dec, jpegdec
#   Special: "all" (all codecs), "all_free" (only free codecs)
#
# Recommended: "all" for full media support
# ============================================================================
_codecs="all"

# Vulkan layers to build
# ============================================================================
# Available: device-select, overlay, screenshot, vram-report-limit, anti-lag
#
# Recommended layers:
#   - device-select: Required for proper GPU selection
#   - overlay: Performance HUD (like MangoHud integration)
#   - anti-lag: AMD Anti-Lag support for reduced input latency
# ============================================================================
_vulkan_layers="device-select,overlay,anti-lag"

##############################################################################
#                             FEATURE TOGGLES                                #
##############################################################################

# Enable Rusticl (Rust-based OpenCL implementation)
# Provides OpenCL 3.0 support for compatible applications
# Requires: Rust toolchain during build
_rusticl="false"

# Enable shader cache (highly recommended for performance)
# Caches compiled shaders to reduce stuttering on subsequent runs
_shader_cache="true"

# Shader cache max size (leave empty for default)
# Examples: "1G", "500M", "2G"
_shader_cache_max_size=""

# Use LLVM for AMD backend
# ============================================================================
# false = Use ACO (AMD's native compiler) - RECOMMENDED, faster compilation
# true  = Use LLVM backend - slightly better code quality in rare cases
# ============================================================================
_amd_use_llvm="false"

# Use LLVM for draw module (software vertex processing)
# Usually only matters for llvmpipe/softpipe
_draw_use_llvm="true"

##############################################################################
#                         OPTIMIZATION SETTINGS                              #
##############################################################################

# Custom optimization flags
# Leave empty to use system/makepkg defaults
# Example: _custom_opt_flags="-O3 -march=native"
# Note: -march=native may cause issues with distributed binaries
_custom_opt_flags=""

# LTO (Link Time Optimization) Configuration
# ============================================================================
# WARNING: As of 2026, upstream Mesa has officially DISABLED LTO support.
# LTO builds are UNSUPPORTED and may cause random, impossible-to-debug issues.
# Bug reports from LTO builds are rejected upstream. USE AT YOUR OWN RISK!
#
# To enable LTO, you MUST set BOTH of the following to "true":
#   _enable_lto="true"        - Request LTO compilation
#   _force_broken_lto="true"  - Acknowledge the risks and force LTO anyway
#
# If _enable_lto="true" but _force_broken_lto="false", the build will fail
# with an error from upstream's meson.build requiring acknowledgment.
# ============================================================================
_enable_lto="false"
_force_broken_lto="false"

##############################################################################
#                             MESON FLAGS                                    #
##############################################################################

# Build type: release, debugoptimized, debug, plain
# "release" is recommended for production use
_build_type="release"

# Additional flags for meson (applied to both 64-bit and 32-bit builds)
# ============================================================================
# Useful flags:
#   -Dc_std=gnu2x -Dcpp_std=gnu++2a  - Use latest C/C++ standards
#   -Db_pie=false                     - Disable PIE (slight performance gain)
#   -Db_pgo=generate / -Db_pgo=use   - Profile-guided optimization
# ============================================================================
_additional_meson_flags="-Dc_std=gnu2x -Dcpp_std=gnu++2a -Db_pie=false"

# 64-bit specific meson flags
# Features like rusticl, display-info that may not have 32-bit support
_additional_meson_flags_64="-Ddisplay-info=enabled"

# 32-bit specific meson flags
# Disable features that don't work or aren't needed for 32-bit
_additional_meson_flags_32="-Ddisplay-info=disabled -Dgallium-rusticl=false"

##############################################################################
#                            SOURCE CONFIGURATION                            #
##############################################################################
# Custom Mesa commit (leave empty to use branch head)
# Example: _mesa_commit="9a5c540b75c1623e9203afc98c3cb61328052861"
_mesa_commit=""

# Mesa branch (only used when _mesa_commit is empty)
_mesa_branch="main"

# Mesa source repository URL
_mesa_source="https://gitlab.freedesktop.org/mesa/mesa.git"

# Pending Mesa merge requests to apply as patches (space-separated MR IDs)
# These are fetched from https://gitlab.freedesktop.org/mesa/mesa/merge_requests/<ID>.diff
# Example: _mesa_prs="12345 67890"
_mesa_prs=""

##############################################################################
#                              USER PATCHES                                  #
##############################################################################

# Community patches - add patches from the community-patches dir by name
# Patches should be space-separated
# Example: _community_patches="intel_haswell_vk_workaround.mymesarevert cool_feature.mymesapatch"
_community_patches=""

# Enable user patches
# Place patches in mesa-userpatches/ directory:
#   - *.mymesapatch  - patches to apply
#   - *.mymesarevert - patches to revert
_user_patches="true"

# Apply all user patches without confirmation prompt
_user_patches_no_confirm="true"
