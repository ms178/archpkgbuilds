From 2183f9bf762a6764a864a2eb0cf423ba9c3eb905 Mon Sep 17 00:00:00 2001
From: Kirill Chibisov <contact@kchibisov.com>
Date: Sun, 2 Nov 2025 22:55:08 +0900
Subject: [PATCH] egl: hide robust context without robust buffer access

The EXT_create_context_robustness says that when this extension is
present, the robust buffer access is possible, however it was not
checked and advertised regardless.

The result of that is having EXT_create_context_robustness without
ability to actually use it.

Closes #14233.
---
 src/egl/drivers/dri2/egl_dri2.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/egl/drivers/dri2/egl_dri2.c b/src/egl/drivers/dri2/egl_dri2.c
index 322dc3f790b9a..48fe45f3956fd 100644
--- a/src/egl/drivers/dri2/egl_dri2.c
+++ b/src/egl/drivers/dri2/egl_dri2.c
@@ -660,7 +660,8 @@ dri2_setup_screen(_EGLDisplay *disp)
    disp->Extensions.EXT_config_select_group = EGL_TRUE;
 
    disp->Extensions.EXT_create_context_robustness =
-      pscreen->caps.device_reset_status_query;
+      pscreen->caps.device_reset_status_query &&
+      pscreen->caps.robust_buffer_access_behavior;
    disp->RobustBufferAccess = pscreen->caps.robust_buffer_access_behavior;
 
    /* EXT_query_reset_notification_strategy complements and requires
-- 
GitLab

