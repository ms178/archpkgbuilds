From 810b6eeeed059679b3dcd71aafd10b2bc2e0a93a Mon Sep 17 00:00:00 2001
From: Adam Jackson <ajax@redhat.com>
Date: Tue, 26 Jul 2022 13:22:57 -0400
Subject: [PATCH] gallium/dri2: Enable {GLX_ARB,EGL_KHR}_context_flush_control

This was disabled ages ago because it provoked bugs between us and
xserver about context creation attributes, hopefully those servers are
out of circulation by now, let's find out.
---
 docs/features.txt                | 2 +-
 docs/relnotes/new_features.txt   | 2 ++
 src/gallium/frontends/dri/dri2.c | 1 +
 3 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/docs/features.txt b/docs/features.txt
index c44569946a26..e9c14217305a 100644
--- a/docs/features.txt
+++ b/docs/features.txt
@@ -347,7 +347,7 @@ Khronos, ARB, and OES extensions that are not part of any OpenGL or OpenGL ES ve
   GL_OES_texture_half_float_linear                      DONE (freedreno, i965, r300, r600, radeonsi, nv30, nv50, nvc0, softpipe, llvmpipe, panfrost, v3d, zink, lima)
   GL_OES_texture_view                                   DONE (freedreno, i965/gen8+, r600, radeonsi, nv50, nvc0, softpipe, llvmpipe, v3d, zink)
   GL_OES_viewport_array                                 DONE (i965, nvc0, r600, radeonsi, softpipe, zink)
-  GLX_ARB_context_flush_control                         not started
+  GLX_ARB_context_flush_control                         DONE (all drivers)
   GLX_ARB_robustness_application_isolation              not started
   GLX_ARB_robustness_share_group_isolation              not started
 
diff --git a/src/gallium/frontends/dri/dri2.c b/src/gallium/frontends/dri/dri2.c
index c05316b2ad55..efbf5e33c015 100644
--- a/src/gallium/frontends/dri/dri2.c
+++ b/src/gallium/frontends/dri/dri2.c
@@ -2366,6 +2366,7 @@ static const __DRIextension *dri_screen_extensions_base[] = {
    &dri2InteropExtension.base,
    &driBlobExtension.base,
    &driMutableRenderBufferExtension.base,
+   &dri2FlushControlExtension.base,
 };
 
 /**
-- 
GitLab

