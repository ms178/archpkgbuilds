From 2ae8d9775d826e279c39393d7febae6dd901f32e Mon Sep 17 00:00:00 2001
From: Paulo Zanoni <paulo.r.zanoni@intel.com>
Date: Fri, 8 Sep 2023 15:10:33 -0700
Subject: [PATCH] vulkan: fix potential memory leak in
 create_rect_list_pipeline()

I was playing around with possible improvements to STACK_ARRAY(), and
one of my experiments made gcc point us that we were not freeing
'stages'.

Fixes: 514c10344e6f ("vulkan/meta: Add a concept of rect pipelines")
Reviewed-by: Karmjit Mahil <Karmjit.Mahil@imgtec.com>
Signed-off-by: Paulo Zanoni <paulo.r.zanoni@intel.com>
---
 src/vulkan/runtime/vk_meta.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/vulkan/runtime/vk_meta.c b/src/vulkan/runtime/vk_meta.c
index 1ea4dc77b0e75..f1570908fb9e4 100644
--- a/src/vulkan/runtime/vk_meta.c
+++ b/src/vulkan/runtime/vk_meta.c
@@ -398,6 +398,7 @@ create_rect_list_pipeline(struct vk_device *device,
                                                    pipeline_out);
 
    STACK_ARRAY_FINISH(dyn_state);
+   STACK_ARRAY_FINISH(stages);
 
    return result;
 }
-- 
GitLab

