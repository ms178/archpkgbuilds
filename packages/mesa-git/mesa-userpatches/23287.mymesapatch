From 6891c073d11eec38f831b189ce408c8653432fc2 Mon Sep 17 00:00:00 2001
From: Georg Lehmann <dadschoorse@gmail.com>
Date: Sun, 28 May 2023 09:12:46 +0200
Subject: [PATCH] nir/opt_if: use nir_alu_instr_is_comparison directly

Since 2d6233d0 ("nir: Check all sizes in nir_alu_instr_is_comparison"),
nir_alu_instr_is_comparison already returns true for comparisons with 32bit
result.
---
 src/compiler/nir/nir_opt_if.c | 22 +---------------------
 1 file changed, 1 insertion(+), 21 deletions(-)

diff --git a/src/compiler/nir/nir_opt_if.c b/src/compiler/nir/nir_opt_if.c
index b1115ef5601f..f640baf13113 100644
--- a/src/compiler/nir/nir_opt_if.c
+++ b/src/compiler/nir/nir_opt_if.c
@@ -269,26 +269,6 @@ opt_peel_loop_initial_if(nir_loop *loop)
    return true;
 }
 
-static bool
-alu_instr_is_comparison(const nir_alu_instr *alu)
-{
-   switch (alu->op) {
-   case nir_op_flt32:
-   case nir_op_fge32:
-   case nir_op_feq32:
-   case nir_op_fneu32:
-   case nir_op_ilt32:
-   case nir_op_ult32:
-   case nir_op_ige32:
-   case nir_op_uge32:
-   case nir_op_ieq32:
-   case nir_op_ine32:
-      return true;
-   default:
-      return nir_alu_instr_is_comparison(alu);
-   }
-}
-
 static bool
 alu_instr_is_type_conversion(const nir_alu_instr *alu)
 {
@@ -423,7 +403,7 @@ opt_split_alu_of_phi(nir_builder *b, nir_loop *loop)
        * conversions also lead to regressions.
        */
       if (nir_op_is_vec(alu->op) ||
-          alu_instr_is_comparison(alu) ||
+          nir_alu_instr_is_comparison(alu) ||
           alu_instr_is_type_conversion(alu))
          continue;
 
-- 
GitLab

