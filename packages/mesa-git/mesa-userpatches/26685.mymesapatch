From 44c7dfabe2688da7afe63829dd11a68fad5c2502 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michel=20D=C3=A4nzer?= <mdaenzer@redhat.com>
Date: Thu, 14 Dec 2023 11:32:53 +0100
Subject: [PATCH 1/2] gallium/dri: Return __DRI_ATTRIB_SWAP_UNDEFINED for
 _SWAP_METHOD

In contrast to __DRI_ATTRIB_SWAP_EXCHANGE, this is compatible with Mesa
< 23.3 on the client side.

Closes: https://gitlab.freedesktop.org/mesa/mesa/-/issues/10080
Fixes: e64ab3e4a94c ("glx: Delete support for GLX_OML_swap_method.")
---
 src/gallium/frontends/dri/dri_util.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/gallium/frontends/dri/dri_util.c b/src/gallium/frontends/dri/dri_util.c
index 2476121634afd..201fc7f63d472 100644
--- a/src/gallium/frontends/dri/dri_util.c
+++ b/src/gallium/frontends/dri/dri_util.c
@@ -326,7 +326,7 @@ driGetConfigAttribIndex(const __DRIconfig *config,
          * for the X server's sake, and EGL will expect us to handle it because
          * it iterates all __DRI_ATTRIBs.
          */
-        *value = __DRI_ATTRIB_SWAP_EXCHANGE;
+        *value = __DRI_ATTRIB_SWAP_UNDEFINED;
         break;
     case __DRI_ATTRIB_MAX_SWAP_INTERVAL:
         *value = INT_MAX;
-- 
GitLab


From 3106afa70de87b5ed3b91609314ed37906897e60 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michel=20D=C3=A4nzer?= <mdaenzer@redhat.com>
Date: Thu, 14 Dec 2023 11:43:44 +0100
Subject: [PATCH 2/2] glx: Handle IGNORE_GLX_SWAP_METHOD_OML regardless of
 GLX_USE_APPLEGL

Avoids tons of

 WARNING: unknown fbconfig attribute from server: tag 0x8060 value 0x8063

messages with LIBGL_DEBUG=verbose.

Fixes: e64ab3e4a94c ("glx: Delete support for GLX_OML_swap_method.")
---
 src/glx/glxext.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/src/glx/glxext.c b/src/glx/glxext.c
index 454f2c36a77fd..05c825a2b07a0 100644
--- a/src/glx/glxext.c
+++ b/src/glx/glxext.c
@@ -563,12 +563,11 @@ __glXInitializeVisualConfigFromTags(struct glx_config * config, int count,
       case GLX_SAMPLES_SGIS:
          config->samples = *bp++;
          break;
-#ifdef GLX_USE_APPLEGL
       case IGNORE_GLX_SWAP_METHOD_OML:
          /* We ignore this tag.  See the comment above this function. */
          ++bp;
          break;
-#else
+#ifndef GLX_USE_APPLEGL
       case GLX_BIND_TO_TEXTURE_RGB_EXT:
          config->bindToTextureRgb = *bp++;
          break;
-- 
GitLab

