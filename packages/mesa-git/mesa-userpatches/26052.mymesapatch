From 489e5c112dab3da8167e8662963e75d6596be7e0 Mon Sep 17 00:00:00 2001
From: Dudemanguy <random342@airmail.cc>
Date: Sat, 4 Nov 2023 23:56:14 -0500
Subject: [PATCH] vulkan/wsi/wayland: fix wl_event_queue memory leak

When creating the swapchain, this queue is created, but it was never
freed in wsi_wl_swapchain_free along with the rest of the resources.
---
 src/vulkan/wsi/wsi_common_wayland.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/vulkan/wsi/wsi_common_wayland.c b/src/vulkan/wsi/wsi_common_wayland.c
index ffc15f32bc568..bd7946f8342a5 100644
--- a/src/vulkan/wsi/wsi_common_wayland.c
+++ b/src/vulkan/wsi/wsi_common_wayland.c
@@ -2209,6 +2209,9 @@ wsi_wl_swapchain_chain_free(struct wsi_wl_swapchain *chain,
       pthread_mutex_destroy(&chain->present_ids.lock);
    }
 
+   if (chain->present_ids.queue)
+      wl_event_queue_destroy(chain->present_ids.queue);
+
    wsi_swapchain_finish(&chain->base);
 }
 
-- 
GitLab

