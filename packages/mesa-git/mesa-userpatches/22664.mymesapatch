From 942f43731f8199d944ffbf11e5962879ddd28302 Mon Sep 17 00:00:00 2001
From: Oleksii Bozhenko <oleksii.bozhenko@globallogic.com>
Date: Mon, 24 Apr 2023 14:13:12 +0300
Subject: [PATCH] dri: fix releasing context

Closes: https://gitlab.freedesktop.org/mesa/mesa/-/issues/8826

Signed-by: Oleksii Bozhenko <oleksii.bozhenko@globallogic.com>
---
 src/glx/dri_common.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/glx/dri_common.c b/src/glx/dri_common.c
index 3421d654b5a2..7e3c75a94a23 100644
--- a/src/glx/dri_common.c
+++ b/src/glx/dri_common.c
@@ -493,7 +493,8 @@ driReleaseDrawables(struct glx_context *gc)
    const struct glx_display *priv = gc->psc->display;
 
    releaseDrawable(priv, gc->currentDrawable);
-   releaseDrawable(priv, gc->currentReadable);
+   if (gc->currentDrawable != gc->currentReadable)
+      releaseDrawable(priv, gc->currentReadable);
 
    gc->currentDrawable = None;
    gc->currentReadable = None;
-- 
GitLab

