From 276aad9a21d4a9bb35e50f0995bdfdb02403220e Mon Sep 17 00:00:00 2001
From: Samuel Pitoiset <samuel.pitoiset@gmail.com>
Date: Thu, 21 Jul 2022 10:13:57 +0200
Subject: [PATCH] radv: ignore out-of-order rasterization if stencil write mask
 is dynamic

This might break out-of-order rasterization on GFX8-GFX9 because it
relies on the stencil write mask which can be dynamic.

Found by inspection.

Cc: mesa-stable
Signed-off-by: Samuel Pitoiset <samuel.pitoiset@gmail.com>
---
 src/amd/vulkan/radv_pipeline.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/amd/vulkan/radv_pipeline.c b/src/amd/vulkan/radv_pipeline.c
index 62beffc4e740..31e727815cb0 100644
--- a/src/amd/vulkan/radv_pipeline.c
+++ b/src/amd/vulkan/radv_pipeline.c
@@ -972,6 +972,7 @@ radv_pipeline_has_dynamic_ds_states(const struct radv_graphics_pipeline *pipelin
                                          RADV_DYNAMIC_DEPTH_WRITE_ENABLE |
                                          RADV_DYNAMIC_DEPTH_COMPARE_OP |
                                          RADV_DYNAMIC_STENCIL_TEST_ENABLE |
+                                         RADV_DYNAMIC_STENCIL_WRITE_MASK |
                                          RADV_DYNAMIC_STENCIL_OP));
 }
 
-- 
GitLab

