From 41c7d4f9781f4d0461be73fcb5e8912fa1ae1d4b Mon Sep 17 00:00:00 2001
From: Vitaliy Triang3l Kuzmin <triang3l@yandex.ru>
Date: Sat, 19 Aug 2023 23:33:10 +0300
Subject: [PATCH] vulkan: Fix pipeline layout allocation scope

The lifetime of Mesa's vk_pipeline_layout may exceed that of the
VkPipelineLayout object as other objects on the device may hold references
to it. In other places in vk_pipeline_layout and vk_descriptor_set_layout,
the device allocation scope is used with this pattern, but there was an
inconsistency in vk_pipeline_layout_zalloc, which is fixed by this commit.

Signed-off-by: Vitaliy Triang3l Kuzmin <triang3l@yandex.ru>
---
 src/vulkan/runtime/vk_pipeline_layout.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/vulkan/runtime/vk_pipeline_layout.c b/src/vulkan/runtime/vk_pipeline_layout.c
index e0f7abe5d0452..df2311ccb8a82 100644
--- a/src/vulkan/runtime/vk_pipeline_layout.c
+++ b/src/vulkan/runtime/vk_pipeline_layout.c
@@ -66,7 +66,7 @@ vk_pipeline_layout_zalloc(struct vk_device *device, size_t size,
     * their own object.
     */
    struct vk_pipeline_layout *layout =
-      vk_zalloc(&device->alloc, size, 8, VK_SYSTEM_ALLOCATION_SCOPE_OBJECT);
+      vk_zalloc(&device->alloc, size, 8, VK_SYSTEM_ALLOCATION_SCOPE_DEVICE);
    if (layout == NULL)
       return NULL;
 
-- 
GitLab

