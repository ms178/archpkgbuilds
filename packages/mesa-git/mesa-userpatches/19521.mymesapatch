From af792d2bd466418f46c023b65b4bca8b1f463d32 Mon Sep 17 00:00:00 2001
From: Samuel Pitoiset <samuel.pitoiset@gmail.com>
Date: Fri, 4 Nov 2022 10:19:48 +0100
Subject: [PATCH] radv: re-emit the guardband state when restoring meta
 operations

Meta operations change dynamic states like viewports and previously,
the guardband state was also always re-emitted because it relied on
dynamic viewport/scissor changes.

Closes: https://gitlab.freedesktop.org/mesa/mesa/-/issues/7577
Fixes: 40d8df72808 ("radv: emit the guardband state separately from the scissor state")
Signed-off-by: Samuel Pitoiset <samuel.pitoiset@gmail.com>
---
 src/amd/vulkan/radv_meta.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/amd/vulkan/radv_meta.c b/src/amd/vulkan/radv_meta.c
index ca4c30f119bb..b442c20c3a2e 100644
--- a/src/amd/vulkan/radv_meta.c
+++ b/src/amd/vulkan/radv_meta.c
@@ -163,6 +163,9 @@ radv_meta_restore(const struct radv_meta_saved_state *state, struct radv_cmd_buf
       /* Restore all dynamic states. */
       cmd_buffer->state.dynamic = state->dynamic;
       cmd_buffer->state.dirty |= RADV_DYNAMIC_ALL;
+
+      /* Re-emit the guardband state because meta operations changed dynamic states. */
+      cmd_buffer->state.dirty |= RADV_CMD_DIRTY_GUARDBAND;
    }
 
    if (state->flags & RADV_META_SAVE_COMPUTE_PIPELINE) {
-- 
GitLab

