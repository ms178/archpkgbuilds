From bb37909c0bd5b9da6ba4a4c1b8dbb64621248d50 Mon Sep 17 00:00:00 2001
From: Rhys Perry <pendingchaos02@gmail.com>
Date: Thu, 30 Mar 2023 16:10:11 +0100
Subject: [PATCH 1/2] aco: give ACCESS_COHERENT load/store accesses
 semantic_atomic

Signed-off-by: Rhys Perry <pendingchaos02@gmail.com>
Cc: mesa-stable
---
 src/amd/compiler/aco_instruction_selection.cpp | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/amd/compiler/aco_instruction_selection.cpp b/src/amd/compiler/aco_instruction_selection.cpp
index d11257b627eb..a1304dc5c427 100644
--- a/src/amd/compiler/aco_instruction_selection.cpp
+++ b/src/amd/compiler/aco_instruction_selection.cpp
@@ -6128,6 +6128,11 @@ get_memory_sync_info(nir_intrinsic_instr* instr, storage_class storage, unsigned
       semantics |= semantic_volatile;
    if (access & ACCESS_CAN_REORDER)
       semantics |= semantic_can_reorder | semantic_private;
+   /* We currently have no way to tell if this is an actual atomic load/store, or a
+    * coherent/make-visible/make-available load/store.
+    */
+   if (access & ACCESS_COHERENT)
+      semantics |= semantic_atomic;
 
    return memory_sync_info(storage, semantics);
 }
-- 
GitLab
