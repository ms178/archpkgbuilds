From bc2164336974aeaf2d2c800fd89afefe021f452c Mon Sep 17 00:00:00 2001
From: Yonggang Luo <luoyonggang@gmail.com>
Date: Fri, 21 Oct 2022 19:16:28 +0800
Subject: [PATCH 1/2] meson: with_glx never assigned to xlib, so need add
 with_glx == 'xlib' for dep_glproto

Fixes: 76791db0882b3715cd7d ("mesa/x11: Remove the swrast-classic-based fake libGL")

Signed-off-by: Yonggang Luo <luoyonggang@gmail.com>
Reviewed-by: Eric Engestrom <eric@igalia.com>
---
 meson.build | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/meson.build b/meson.build
index 0cfd5a7dc990..b02e2467cc17 100644
--- a/meson.build
+++ b/meson.build
@@ -2141,7 +2141,7 @@ if with_platform_x11
       dep_xshmfence = dependency('xshmfence', version : '>= 1.1')
     endif
   endif
-  if with_glx == 'dri' or with_glx == 'gallium-xlib'
+  if with_glx == 'dri' or with_glx == 'xlib' or with_glx == 'gallium-xlib'
     dep_glproto = dependency('glproto', version : '>= 1.4.14')
   endif
   if with_glx == 'dri'
-- 
GitLab


From e91028b5d5f9cdb45a2ad5a8ae0fae19728581f5 Mon Sep 17 00:00:00 2001
From: Yonggang Luo <luoyonggang@gmail.com>
Date: Fri, 21 Oct 2022 19:17:08 +0800
Subject: [PATCH 2/2] meson: with_glx never assigned to 'gallium-xlib', remove
 'gallium-xlib'

Signed-off-by: Yonggang Luo <luoyonggang@gmail.com>
Reviewed-by: Eric Engestrom <eric@igalia.com>
---
 meson.build                           | 8 ++++----
 src/gallium/auxiliary/meson.build     | 2 +-
 src/gallium/targets/va/meson.build    | 2 +-
 src/gallium/targets/vdpau/meson.build | 2 +-
 4 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/meson.build b/meson.build
index b02e2467cc17..f70188fc7b39 100644
--- a/meson.build
+++ b/meson.build
@@ -939,7 +939,7 @@ endif
 
 gl_pkgconfig_c_flags = []
 if with_platform_x11
-  if with_glx == 'xlib' or with_glx == 'gallium-xlib'
+  if with_glx == 'xlib'
     pre_args += '-DUSE_XSHM'
   else
     pre_args += '-DGLX_INDIRECT_RENDERING'
@@ -2104,7 +2104,7 @@ endif
 
 with_dri3_modifiers = false
 if with_platform_x11
-  if with_glx == 'xlib' or with_glx == 'gallium-xlib'
+  if with_glx == 'xlib'
     dep_x11 = dependency('x11')
     dep_xext = dependency('xext')
     dep_xcb = dependency('xcb')
@@ -2141,7 +2141,7 @@ if with_platform_x11
       dep_xshmfence = dependency('xshmfence', version : '>= 1.1')
     endif
   endif
-  if with_glx == 'dri' or with_glx == 'xlib' or with_glx == 'gallium-xlib'
+  if with_glx == 'dri' or with_glx == 'xlib'
     dep_glproto = dependency('glproto', version : '>= 1.4.14')
   endif
   if with_glx == 'dri'
@@ -2223,7 +2223,7 @@ add_project_arguments(cpp_args, language : ['cpp'])
 
 gl_priv_reqs = []
 
-if with_glx == 'xlib' or with_glx == 'gallium-xlib'
+if with_glx == 'xlib'
   gl_priv_reqs += ['x11', 'xext', 'xcb']
 elif with_glx == 'dri'
   gl_priv_reqs += [
diff --git a/src/gallium/auxiliary/meson.build b/src/gallium/auxiliary/meson.build
index 820bf5ea7b12..10a9542f813c 100644
--- a/src/gallium/auxiliary/meson.build
+++ b/src/gallium/auxiliary/meson.build
@@ -455,7 +455,7 @@ if with_dri2 and with_platform_x11
   endif
 endif
 
-if with_glx == 'xlib' or with_glx == 'gallium-xlib'
+if with_glx == 'xlib'
   files_libgalliumvlwinsys += files('vl/vl_winsys_xlib_swrast.c')
 elif with_gallium_drisw_kms
   files_libgalliumvlwinsys += files('vl/vl_winsys_dri_vgem.c')
diff --git a/src/gallium/targets/va/meson.build b/src/gallium/targets/va/meson.build
index 02664fef8781..d0691729f43e 100644
--- a/src/gallium/targets/va/meson.build
+++ b/src/gallium/targets/va/meson.build
@@ -36,7 +36,7 @@ link_with_libva_gallium = [
   libpipe_loader_static, libws_null, libwsw, libswdri, libswkmsdri,
 ]
 
-if with_glx == 'xlib' or with_glx == 'gallium-xlib'
+if with_glx == 'xlib'
   link_with_libva_gallium += [libws_xlib]
 endif
 
diff --git a/src/gallium/targets/vdpau/meson.build b/src/gallium/targets/vdpau/meson.build
index d51af5c2bde5..0fbbe95b454c 100644
--- a/src/gallium/targets/vdpau/meson.build
+++ b/src/gallium/targets/vdpau/meson.build
@@ -40,7 +40,7 @@ link_with_libvdpau_gallium = [
   libpipe_loader_static, libws_null, libwsw, libswdri, libswkmsdri,
 ]
 
-if with_glx == 'xlib' or with_glx == 'gallium-xlib'
+if with_glx == 'xlib'
   link_with_libvdpau_gallium += [libws_xlib]
 endif
 
-- 
GitLab

