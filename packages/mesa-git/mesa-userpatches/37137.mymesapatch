From 9994efb2caf6ed8e40a22dfd48a82f3400d04754 Mon Sep 17 00:00:00 2001
From: Hans-Kristian Arntzen <post@arntzen-software.no>
Date: Tue, 2 Sep 2025 15:11:35 +0200
Subject: [PATCH] anti-lag: Don't force enable every supported feature on
 device creation.
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Hans-Kristian Arntzen <post@arntzen-software.no>
Fixes: 722ffe9a739 ("vulkan: implement VK_AMD_anti_lag as implicit vulkan layer")
Cc: mesa-stable
Reviewed-by: Daniel Sch√ºrmann <daniel@schuermann.dev>
---
 src/vulkan/anti-lag-layer/anti_lag_layer_interface.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/vulkan/anti-lag-layer/anti_lag_layer_interface.c b/src/vulkan/anti-lag-layer/anti_lag_layer_interface.c
index 6a803e24fe621..37d9c494346be 100644
--- a/src/vulkan/anti-lag-layer/anti_lag_layer_interface.c
+++ b/src/vulkan/anti-lag-layer/anti_lag_layer_interface.c
@@ -271,6 +271,10 @@ should_enable_layer(instance_data *ctx, VkPhysicalDevice physicalDevice,
 
    /* Ensure that the underlying implementation does not expose VK_AMD_anti_lag itself. */
    ext_feature.antiLag = false;
+
+   /* Don't clobber unrelated pNext chains passed in at device creation time. */
+   ext_feature.pNext = NULL;
+
    VkPhysicalDeviceFeatures2 features = {
       .sType = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_FEATURES_2,
       .pNext = &ext_feature,
-- 
GitLab

