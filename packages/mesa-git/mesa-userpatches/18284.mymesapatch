From 41344eedcc8086b7e812aed03fee10face04e147 Mon Sep 17 00:00:00 2001
From: Tatsuyuki Ishi <ishitatsuyuki@gmail.com>
Date: Sat, 27 Aug 2022 18:27:42 +0900
Subject: [PATCH 1/3] radv: Remove unused functions.

Grep shows no usage.
Found by manual inspection.

Reviewed-by: Samuel Pitoiset <samuel.pitoiset@gmail.com>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/18284>
---
 src/amd/vulkan/radv_device.c  |  6 ------
 src/amd/vulkan/radv_private.h | 26 --------------------------
 2 files changed, 32 deletions(-)

diff --git a/src/amd/vulkan/radv_device.c b/src/amd/vulkan/radv_device.c
index a311e65a573f..8109a8bb2a57 100644
--- a/src/amd/vulkan/radv_device.c
+++ b/src/amd/vulkan/radv_device.c
@@ -92,12 +92,6 @@ typedef void *drmDevicePtr;
 
 static VkResult radv_queue_submit(struct vk_queue *vqueue, struct vk_queue_submit *submission);
 
-uint64_t
-radv_get_current_time(void)
-{
-   return os_time_get_nano();
-}
-
 static void
 parse_hex(char *out, const char *in, unsigned length)
 {
diff --git a/src/amd/vulkan/radv_private.h b/src/amd/vulkan/radv_private.h
index dc5c6738d8a6..07dba41a30e6 100644
--- a/src/amd/vulkan/radv_private.h
+++ b/src/amd/vulkan/radv_private.h
@@ -2929,32 +2929,6 @@ uint32_t radv_get_indirect_cmdbuf_size(const VkGeneratedCommandsInfoNV *cmd_info
 void radv_prepare_dgc(struct radv_cmd_buffer *cmd_buffer,
                       const VkGeneratedCommandsInfoNV *pGeneratedCommandsInfo);
 
-uint64_t radv_get_current_time(void);
-
-static inline uint32_t
-si_conv_gl_prim_to_vertices(enum shader_prim gl_prim)
-{
-   switch (gl_prim) {
-   case SHADER_PRIM_POINTS:
-      return 1;
-   case SHADER_PRIM_LINES:
-   case SHADER_PRIM_LINE_STRIP:
-      return 2;
-   case SHADER_PRIM_TRIANGLES:
-   case SHADER_PRIM_TRIANGLE_STRIP:
-      return 3;
-   case SHADER_PRIM_LINES_ADJACENCY:
-      return 4;
-   case SHADER_PRIM_TRIANGLES_ADJACENCY:
-      return 6;
-   case SHADER_PRIM_QUADS:
-      return V_028A6C_TRISTRIP;
-   default:
-      assert(0);
-      return 0;
-   }
-}
-
 static inline uint32_t
 si_conv_prim_to_gs_out(uint32_t topology)
 {
-- 
GitLab


From 9cca4c23848c2ea3db1e149c1f0893c857998bfd Mon Sep 17 00:00:00 2001
From: Tatsuyuki Ishi <ishitatsuyuki@gmail.com>
Date: Sun, 28 Aug 2022 22:06:36 +0900
Subject: [PATCH 2/3] radv: Remove unused radv_deferred_queue_submission.

Has been stale since the common sync migration.

Reviewed-by: Samuel Pitoiset <samuel.pitoiset@gmail.com>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/18284>
---
 src/amd/vulkan/radv_device.c  | 33 ---------------------------------
 src/amd/vulkan/radv_private.h |  2 --
 2 files changed, 35 deletions(-)

diff --git a/src/amd/vulkan/radv_device.c b/src/amd/vulkan/radv_device.c
index 8109a8bb2a57..50df4e602318 100644
--- a/src/amd/vulkan/radv_device.c
+++ b/src/amd/vulkan/radv_device.c
@@ -4986,39 +4986,6 @@ radv_cmd_buffer_needs_ace(const struct radv_cmd_buffer *cmd_buffer)
    return cmd_buffer->ace_internal.cs && cmd_buffer->task_rings_needed;
 }
 
-struct radv_deferred_queue_submission {
-   struct radv_queue *queue;
-   VkCommandBuffer *cmd_buffers;
-   uint32_t cmd_buffer_count;
-
-   /* Sparse bindings that happen on a queue. */
-   VkSparseBufferMemoryBindInfo *buffer_binds;
-   uint32_t buffer_bind_count;
-   VkSparseImageOpaqueMemoryBindInfo *image_opaque_binds;
-   uint32_t image_opaque_bind_count;
-   VkSparseImageMemoryBindInfo *image_binds;
-   uint32_t image_bind_count;
-
-   bool flush_caches;
-   VkPipelineStageFlags2 wait_dst_stage_mask;
-   struct radv_semaphore_part **wait_semaphores;
-   uint32_t wait_semaphore_count;
-   struct radv_semaphore_part **signal_semaphores;
-   uint32_t signal_semaphore_count;
-   VkFence fence;
-
-   uint64_t *wait_values;
-   uint64_t *signal_values;
-
-   struct radv_semaphore_part *temporary_semaphore_parts;
-   uint32_t temporary_semaphore_part_count;
-
-   struct list_head queue_pending_list;
-   uint32_t submission_wait_count;
-
-   struct list_head processing_list;
-};
-
 static VkResult
 radv_queue_submit_bind_sparse_memory(struct radv_device *device, struct vk_queue_submit *submission)
 {
diff --git a/src/amd/vulkan/radv_private.h b/src/amd/vulkan/radv_private.h
index 07dba41a30e6..37cdf946c15b 100644
--- a/src/amd/vulkan/radv_private.h
+++ b/src/amd/vulkan/radv_private.h
@@ -707,8 +707,6 @@ struct radv_meta_state {
 
 #define RADV_NUM_HW_CTX (RADEON_CTX_PRIORITY_REALTIME + 1)
 
-struct radv_deferred_queue_submission;
-
 static inline enum radv_queue_family
 vk_queue_to_radv(const struct radv_physical_device *phys_dev, int queue_family_index)
 {
-- 
GitLab


From 8a36c9f5e0be7587876442302c974aa13ea6ebb2 Mon Sep 17 00:00:00 2001
From: Tatsuyuki Ishi <ishitatsuyuki@gmail.com>
Date: Sun, 28 Aug 2022 22:13:04 +0900
Subject: [PATCH 3/3] radv,lvp,anv: Delete pre-common dispatch leftover.

These functions are no longer used since the introduction of common
dispatch.

Reviewed-by: Samuel Pitoiset <samuel.pitoiset@gmail.com>
Acked-by: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
Acked-by: Mike Blumenkrantz <michael.blumenkrantz@gmail.com>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/18284>
---
 src/amd/vulkan/radv_private.h                |  8 -------
 src/gallium/frontends/lavapipe/lvp_private.h | 16 --------------
 src/intel/vulkan/anv_private.h               | 22 --------------------
 3 files changed, 46 deletions(-)

diff --git a/src/amd/vulkan/radv_private.h b/src/amd/vulkan/radv_private.h
index 37cdf946c15b..5dc01b97fcaa 100644
--- a/src/amd/vulkan/radv_private.h
+++ b/src/amd/vulkan/radv_private.h
@@ -242,14 +242,6 @@ struct radv_instance;
    } while (0)
 #endif
 
-int radv_get_instance_entrypoint_index(const char *name);
-int radv_get_device_entrypoint_index(const char *name);
-int radv_get_physical_device_entrypoint_index(const char *name);
-
-const char *radv_get_instance_entry_name(int index);
-const char *radv_get_physical_device_entry_name(int index);
-const char *radv_get_device_entry_name(int index);
-
 /* queue types */
 enum radv_queue_family {
    RADV_QUEUE_GENERAL,
diff --git a/src/gallium/frontends/lavapipe/lvp_private.h b/src/gallium/frontends/lavapipe/lvp_private.h
index 9ba562143f6f..1a8befbaf1c3 100644
--- a/src/gallium/frontends/lavapipe/lvp_private.h
+++ b/src/gallium/frontends/lavapipe/lvp_private.h
@@ -93,22 +93,6 @@ extern "C" {
 #define lvp_printflike(a, b) __attribute__((__format__(__printf__, a, b)))
 #endif
 
-int lvp_get_instance_entrypoint_index(const char *name);
-int lvp_get_device_entrypoint_index(const char *name);
-int lvp_get_physical_device_entrypoint_index(const char *name);
-
-const char *lvp_get_instance_entry_name(int index);
-const char *lvp_get_physical_device_entry_name(int index);
-const char *lvp_get_device_entry_name(int index);
-
-bool lvp_instance_entrypoint_is_enabled(int index, uint32_t core_version,
-                                         const struct vk_instance_extension_table *instance);
-bool lvp_physical_device_entrypoint_is_enabled(int index, uint32_t core_version,
-                                                const struct vk_instance_extension_table *instance);
-bool lvp_device_entrypoint_is_enabled(int index, uint32_t core_version,
-                                       const struct vk_instance_extension_table *instance,
-                                       const struct vk_device_extension_table *device);
-
 #define LVP_DEBUG_ALL_ENTRYPOINTS (1 << 0)
 
 void __lvp_finishme(const char *file, int line, const char *format, ...)
diff --git a/src/intel/vulkan/anv_private.h b/src/intel/vulkan/anv_private.h
index bcd44d4184d4..55e7a526470c 100644
--- a/src/intel/vulkan/anv_private.h
+++ b/src/intel/vulkan/anv_private.h
@@ -4113,28 +4113,6 @@ struct anv_acceleration_structure {
    struct anv_address                           address;
 };
 
-int anv_get_instance_entrypoint_index(const char *name);
-int anv_get_device_entrypoint_index(const char *name);
-int anv_get_physical_device_entrypoint_index(const char *name);
-
-const char *anv_get_instance_entry_name(int index);
-const char *anv_get_physical_device_entry_name(int index);
-const char *anv_get_device_entry_name(int index);
-
-bool
-anv_instance_entrypoint_is_enabled(int index, uint32_t core_version,
-                                   const struct vk_instance_extension_table *instance);
-bool
-anv_physical_device_entrypoint_is_enabled(int index, uint32_t core_version,
-                                          const struct vk_instance_extension_table *instance);
-bool
-anv_device_entrypoint_is_enabled(int index, uint32_t core_version,
-                                 const struct vk_instance_extension_table *instance,
-                                 const struct vk_device_extension_table *device);
-
-const struct vk_device_dispatch_table *
-anv_get_device_dispatch_table(const struct intel_device_info *devinfo);
-
 void
 anv_dump_pipe_bits(enum anv_pipe_bits bits);
 
-- 
GitLab

