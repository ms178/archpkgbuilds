From 9ea6834d9e4eb8bc41b9f950b437d2ecd3b4e149 Mon Sep 17 00:00:00 2001
From: Samuel Pitoiset <samuel.pitoiset@gmail.com>
Date: Thu, 23 Feb 2023 09:50:17 +0100
Subject: [PATCH] radv: fix border color swizzle for depth/stencil images on
 GFX9+

Depth/stencil images either have 1 or 2 components and the swizzle
is always X,0,0,1, so it should be BC_SWIZZLE_XYZW.

Fixes dEQP-VK.pipeline.monolithic.sampler.border_swizzle.* with
depth/stencil formats.

Cc: mesa-stable
Signed-off-by: Samuel Pitoiset <samuel.pitoiset@gmail.com>
---
 src/amd/vulkan/radv_image.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/amd/vulkan/radv_image.c b/src/amd/vulkan/radv_image.c
index 02fd2d53606d..16af8044d056 100644
--- a/src/amd/vulkan/radv_image.c
+++ b/src/amd/vulkan/radv_image.c
@@ -943,6 +943,9 @@ gfx9_border_color_swizzle(const struct util_format_description *desc)
 {
    unsigned bc_swizzle = V_008F20_BC_SWIZZLE_XYZW;
 
+   if (desc->colorspace == UTIL_FORMAT_COLORSPACE_ZS)
+      return bc_swizzle;
+
    if (desc->swizzle[3] == PIPE_SWIZZLE_X) {
       /* For the pre-defined border color values (white, opaque
        * black, transparent black), the only thing that matters is
-- 
GitLab

