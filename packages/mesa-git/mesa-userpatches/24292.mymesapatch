From 050c4d68455adada9abfd8238b2dfd29dfc08c24 Mon Sep 17 00:00:00 2001
From: Eric Engestrom <eric@igalia.com>
Date: Sat, 22 Jul 2023 11:04:19 +0100
Subject: [PATCH 1/2] egl: make _eglFilterConfigArray static

Signed-off-by: Eric Engestrom <eric@igalia.com>
---
 src/egl/main/eglconfig.c | 2 +-
 src/egl/main/eglconfig.h | 8 --------
 2 files changed, 1 insertion(+), 9 deletions(-)

diff --git a/src/egl/main/eglconfig.c b/src/egl/main/eglconfig.c
index 9281ccd347fcf..ffe0654db7d52 100644
--- a/src/egl/main/eglconfig.c
+++ b/src/egl/main/eglconfig.c
@@ -699,7 +699,7 @@ _eglSortConfigs(const _EGLConfig **configs, EGLint count,
  * A helper function for implementing eglChooseConfig.  See _eglFilterArray and
  * _eglSortConfigs for the meanings of match and compare.
  */
-EGLBoolean
+static EGLBoolean
 _eglFilterConfigArray(_EGLArray *array, EGLConfig *configs, EGLint config_size,
                       EGLint *num_configs,
                       EGLBoolean (*match)(const _EGLConfig *, void *),
diff --git a/src/egl/main/eglconfig.h b/src/egl/main/eglconfig.h
index e7caea20bbc5c..15a91d13e5fec 100644
--- a/src/egl/main/eglconfig.h
+++ b/src/egl/main/eglconfig.h
@@ -199,14 +199,6 @@ extern EGLint
 _eglCompareConfigs(const _EGLConfig *conf1, const _EGLConfig *conf2,
                    const _EGLConfig *criteria, EGLBoolean compare_id);
 
-extern EGLBoolean
-_eglFilterConfigArray(_EGLArray *array, EGLConfig *configs, EGLint config_size,
-                      EGLint *num_configs,
-                      EGLBoolean (*match)(const _EGLConfig *, void *),
-                      EGLint (*compare)(const _EGLConfig *, const _EGLConfig *,
-                                        void *),
-                      void *filter_data);
-
 extern EGLBoolean
 _eglChooseConfig(_EGLDisplay *disp, const EGLint *attrib_list,
                  EGLConfig *configs, EGLint config_size, EGLint *num_config);
-- 
GitLab


From a9de27af1341d3f7f2191b8f20bb2889aa25a27a Mon Sep 17 00:00:00 2001
From: Eric Engestrom <eric@igalia.com>
Date: Sat, 22 Jul 2023 10:57:22 +0100
Subject: [PATCH 2/2] egl: fixup _eglFilterConfigArray() params and drop
 _eglFallbackMatch() wrapper

Signed-off-by: Eric Engestrom <eric@engestrom.ch>
---
 src/egl/main/eglconfig.c | 11 +++--------
 1 file changed, 3 insertions(+), 8 deletions(-)

diff --git a/src/egl/main/eglconfig.c b/src/egl/main/eglconfig.c
index ffe0654db7d52..e962c6f32e389 100644
--- a/src/egl/main/eglconfig.c
+++ b/src/egl/main/eglconfig.c
@@ -702,7 +702,8 @@ _eglSortConfigs(const _EGLConfig **configs, EGLint count,
 static EGLBoolean
 _eglFilterConfigArray(_EGLArray *array, EGLConfig *configs, EGLint config_size,
                       EGLint *num_configs,
-                      EGLBoolean (*match)(const _EGLConfig *, void *),
+                      EGLBoolean (*match)(const _EGLConfig *,
+                                          const _EGLConfig *),
                       EGLint (*compare)(const _EGLConfig *, const _EGLConfig *,
                                         void *),
                       void *priv_data)
@@ -741,12 +742,6 @@ _eglFilterConfigArray(_EGLArray *array, EGLConfig *configs, EGLint config_size,
    return EGL_TRUE;
 }
 
-static EGLBoolean
-_eglFallbackMatch(const _EGLConfig *conf, void *priv_data)
-{
-   return _eglMatchConfig(conf, (const _EGLConfig *)priv_data);
-}
-
 static EGLint
 _eglFallbackCompare(const _EGLConfig *conf1, const _EGLConfig *conf2,
                     void *priv_data)
@@ -769,7 +764,7 @@ _eglChooseConfig(_EGLDisplay *disp, const EGLint *attrib_list,
       return _eglError(EGL_BAD_ATTRIBUTE, "eglChooseConfig");
 
    result = _eglFilterConfigArray(disp->Configs, configs, config_size,
-                                  num_configs, _eglFallbackMatch,
+                                  num_configs, _eglMatchConfig,
                                   _eglFallbackCompare, (void *)&criteria);
 
    if (result && (_eglGetLogLevel() == _EGL_DEBUG))
-- 
GitLab

