From 32a1ccd74a36ba0460da83db148afc926287b6b2 Mon Sep 17 00:00:00 2001
From: James Zhu <James.Zhu@amd.com>
Date: Mon, 29 Aug 2022 15:46:20 -0400
Subject: [PATCH] amd/common: some ASICs with gfx9 use compute rings for render
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Some ASICs with gfx9 use compute rings for render.

Fixes: 983223de5dc01f50 - ac/gpu_info: use the kernel-reported
GFX IP version to set gfx_level

Signed-off-by: James Zhu <James.Zhu@amd.com>
Reviewed-by: Marek Olšák <marek.olsak@amd.com>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/18302>
---
 src/amd/common/ac_gpu_info.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/amd/common/ac_gpu_info.c b/src/amd/common/ac_gpu_info.c
index 37c8cff04152..408f1a4cb302 100644
--- a/src/amd/common/ac_gpu_info.c
+++ b/src/amd/common/ac_gpu_info.c
@@ -852,7 +852,7 @@ bool ac_query_gpu_info(int fd, void *dev_p, struct radeon_info *info)
       info->gfx_level = GFX10_3;
    else if (info->ip[AMD_IP_GFX].ver_major == 10 && info->ip[AMD_IP_GFX].ver_minor == 1)
       info->gfx_level = GFX10;
-   else if (info->ip[AMD_IP_GFX].ver_major == 9)
+   else if (info->ip[AMD_IP_GFX].ver_major == 9 || info->ip[AMD_IP_COMPUTE].ver_major == 9)
       info->gfx_level = GFX9;
    else if (info->ip[AMD_IP_GFX].ver_major == 8)
       info->gfx_level = GFX8;
-- 
GitLab

